<div
  class="relative min-h-screen font-sans text-gray-900 bg-white dark:bg-slate-950 dark:text-slate-200 selection:bg-indigo-500 selection:text-white pb-80">

  <header
    class="sticky top-0 z-40 px-8 py-6 border-b border-gray-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/50 backdrop-blur-sm">
    <div class="flex items-center justify-between mx-auto max-w-7xl">

      <div class="flex items-center gap-3">
        <img src="favicon.png" alt="Logo" class="w-10 h-10 rounded-lg shadow-lg shadow-indigo-500/10">

        <div>
          <div class="flex items-baseline gap-3">
            <h1 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
              Launcher
            </h1>
            <span
              class="px-2 py-0.5 rounded text-[10px] font-bold bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-slate-400 border border-gray-300 dark:border-slate-700 uppercase tracking-wider">
              Beta
            </span>
          </div>
          <p class="text-xs text-gray-500 dark:text-slate-500 font-mono -mt-0.5">Gerenciador de Ambientes</p>
        </div>
      </div>

      <div class="flex items-center gap-6">

        <div
          class="bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-800 rounded-lg px-4 py-1.5 flex items-center gap-3 shadow-sm">
          <div class="flex items-center gap-2">
            <span class="relative flex w-3 h-3">
              <span *ngIf="runningProjects.length > 0"
                class="absolute inline-flex w-full h-full rounded-full opacity-75 animate-ping bg-emerald-400"></span>
              <span [class.bg-emerald-500]="runningProjects.length > 0"
                [class.bg-gray-400]="runningProjects.length === 0"
                [class.dark:bg-slate-600]="runningProjects.length === 0"
                class="relative inline-flex w-3 h-3 transition-colors duration-500 rounded-full"></span>
            </span>
            <span class="text-sm font-medium text-gray-700 dark:text-slate-300 tabular-nums">
              {{ runningProjects.length }} <span class="ml-1 text-xs text-gray-500 dark:text-slate-500">ativos</span>
            </span>
          </div>
        </div>

        <div class="w-px h-6 bg-gray-200 dark:bg-slate-800"></div>

        <div class="flex p-1 border border-gray-200 rounded-lg dark:border-slate-800 bg-gray-50 dark:bg-slate-900">
          <button (click)="toggleViewMode()" [ngClass]="{
            'bg-white dark:bg-slate-700 text-gray-900 dark:text-white': viewMode === 'grid',
            'text-gray-500 dark:text-slate-400 hover:text-gray-900 dark:hover:text-white': true
          }" class="p-2 transition-all rounded" title="Grade">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
            </svg>
          </button>

          <button (click)="toggleViewMode()" [ngClass]="{
            'bg-white dark:bg-slate-700 text-gray-900 dark:text-white': viewMode === 'list',
            'text-gray-500 dark:text-slate-400 hover:text-gray-900 dark:hover:text-white': true
          }"
            class="p-2 text-gray-500 transition-all rounded dark:text-slate-400 hover:text-gray-900 dark:hover:text-white"
            title="Lista">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>

      </div>
    </div>
  </header>

  <main class="px-8 py-10 mx-auto max-w-7xl">

    <div *ngIf="viewMode === 'grid'" class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-2 animate-fade-in">
      <div *ngFor="let app of projects"
        class="relative flex flex-col overflow-hidden transition-all duration-300 bg-white border border-gray-200 shadow-lg group dark:bg-slate-900 dark:border-slate-800 rounded-xl hover:border-indigo-500/50 dark:hover:border-indigo-500/50">

        <div class="absolute top-0 left-0 w-full h-1 transition-colors duration-300"
          [ngClass]="isRunning(app) ? 'bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]' : 'bg-gray-300 dark:bg-slate-700'">
        </div>

        <div class="flex-1 p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="p-3 text-2xl bg-gray-100 rounded-lg dark:bg-slate-800">üì¶</div>
            <span class="px-2 py-1 font-mono text-xs font-medium tracking-wider uppercase border rounded"
              [ngClass]="isRunning(app) ? 'bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-300 dark:border-emerald-500/20' : 'bg-gray-100 dark:bg-slate-800 text-gray-500 dark:text-slate-500 border-gray-300 dark:border-slate-700'">
              {{ isRunning(app) ? 'ONLINE' : 'OFFLINE' }}
            </span>
          </div>
          <h3
            class="mb-2 text-xl font-semibold text-gray-900 transition-colors dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400">
            {{ app.name }}</h3>
          <p
            class="p-2 font-mono text-xs text-gray-500 truncate border border-gray-200 rounded dark:text-slate-500 bg-gray-50 dark:bg-slate-950/50 dark:border-slate-800/50">
            {{ app.path }}</p>
        </div>

        <div
          class="flex flex-col gap-2 p-4 border-t border-gray-200 bg-gray-50 dark:bg-slate-900 dark:border-slate-800">
          <button *ngIf="!isRunning(app)" (click)="launchProject(app)"
            class="w-full py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition-all shadow-lg shadow-indigo-900/20">
            ‚ñ∂ Iniciar Ambiente
          </button>
          <div *ngIf="isRunning(app)" class="grid grid-cols-2 gap-2">
            <button (click)="restartProject(app)"
              class="py-2 text-sm font-medium transition-colors border rounded-lg bg-amber-50 dark:bg-amber-600/10 hover:bg-amber-100 dark:hover:bg-amber-600/20 text-amber-600 dark:text-amber-500 border-amber-300 dark:border-amber-600/30">‚Üª
              Reiniciar</button>
            <button (click)="stopProject(app)"
              class="py-2 text-sm font-medium transition-colors border rounded-lg bg-rose-50 dark:bg-rose-600/10 hover:bg-rose-100 dark:hover:bg-rose-600/20 text-rose-600 dark:text-rose-500 border-rose-300 dark:border-rose-600/30">‚èπ
              Parar</button>
            <button (click)="selectedLogTab = app.name"
              class="col-span-2 py-2 text-sm text-gray-700 transition-colors bg-gray-100 border border-gray-300 rounded-lg dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 dark:text-slate-300 dark:border-slate-700">
              üíª Ver Logs
            </button>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <button (click)="openVSCode(app)"
              class="flex items-center justify-center gap-1 py-2 text-sm font-medium text-gray-700 transition-colors bg-gray-100 border border-gray-300 rounded-lg dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 dark:text-slate-300 dark:border-slate-700">
              <span>üìù</span> VS Code
            </button>
            <button *ngIf="app.baseUrl || app.browserUrl" (click)="openBrowser(app)"
              class="flex items-center justify-center gap-1 py-2 text-sm font-medium text-blue-600 transition-colors border border-blue-300 rounded-lg bg-blue-50 dark:bg-blue-600/10 hover:bg-blue-100 dark:hover:bg-blue-600/20 dark:text-blue-400 dark:border-blue-600/30">
              <span>üåê</span> Abrir
            </button>
            <button *ngIf="!app.baseUrl && !app.browserUrl"
              class="flex items-center justify-center gap-1 py-2 text-sm font-medium text-gray-400 transition-colors border border-gray-200 rounded-lg cursor-not-allowed bg-gray-50 dark:bg-slate-800/50 dark:text-slate-500 dark:border-slate-700"
              disabled>
              <span>üåê</span> Abrir
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="viewMode === 'list'" class="flex flex-col gap-3 animate-fade-in">
      <div *ngFor="let app of projects"
        class="flex items-center justify-between p-4 transition-all bg-white border border-gray-200 rounded-lg group dark:bg-slate-900 dark:border-slate-800 hover:border-indigo-500/30 dark:hover:border-indigo-500/30 hover:bg-gray-50 dark:hover:bg-slate-900/80">
        <div class="flex items-center flex-1 min-w-0 gap-4">
          <div class="w-1.5 h-12 rounded-full transition-colors"
            [ngClass]="isRunning(app) ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.6)]' : 'bg-gray-300 dark:bg-slate-700'">
          </div>
          <div class="min-w-0">
            <div class="flex items-center gap-3">
              <h3
                class="text-lg font-semibold text-gray-900 truncate transition-colors dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400">
                {{ app.name }}</h3>
              <span *ngIf="isRunning(app)"
                class="text-[10px] px-1.5 py-0.5 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border border-emerald-300 dark:border-emerald-500/20 rounded font-mono uppercase">Running</span>
            </div>
            <p class="font-mono text-xs text-gray-500 truncate dark:text-slate-500 opacity-60">{{ app.path }}</p>
          </div>
        </div>

        <div class="flex items-center gap-3 pl-4 ml-4 border-l border-gray-200 dark:border-slate-800/50">
          <button *ngIf="!isRunning(app)" (click)="launchProject(app)"
            class="px-4 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-sm rounded transition-colors shadow-lg shadow-indigo-500/20 flex items-center gap-2">
            ‚ñ∂ Iniciar
          </button>
          <ng-container *ngIf="isRunning(app)">
            <button (click)="selectedLogTab = app.name" title="Logs"
              class="p-2 text-gray-500 transition-colors rounded dark:text-slate-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-slate-800"><svg
                xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg></button>
            <button (click)="restartProject(app)" title="Reiniciar"
              class="p-2 transition-colors rounded text-amber-600 dark:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10"><svg
                xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg></button>
            <button (click)="stopProject(app)" title="Parar"
              class="p-2 transition-colors rounded text-rose-600 dark:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-500/10"><svg
                xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
              </svg></button>
            <button (click)="openVSCode(app)" title="Abrir VS Code"
              class="p-2 text-blue-600 transition-colors rounded dark:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-500/10"><svg
                xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
              </svg></button>
            <button *ngIf="app.baseUrl || app.browserUrl" (click)="openBrowser(app)" title="Abrir no Browser"
              class="p-2 transition-colors rounded text-emerald-600 dark:text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10"><svg
                xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
              </svg></button>
          </ng-container>
        </div>
      </div>
    </div>
  </main>

  <div *ngIf="selectedLogTab"
    class="fixed bottom-0 left-0 right-0 h-80 bg-white dark:bg-slate-950 border-t border-gray-200 dark:border-slate-800 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] dark:shadow-[0_-10px_40px_rgba(0,0,0,0.7)] flex flex-col z-50 animate-slide-up">

    <div
      class="flex items-center justify-between px-4 py-2 border-b border-gray-200 bg-gray-50 dark:bg-slate-900 dark:border-slate-800">
      <div class="flex items-center gap-3">
        <span class="font-mono text-xs tracking-widest text-gray-500 uppercase dark:text-slate-500">Terminal
          Output</span>
        <div
          class="flex items-center gap-2 px-2 py-0.5 bg-gray-100 dark:bg-slate-800 rounded border border-gray-300 dark:border-slate-700">
          <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
          <span class="text-sm font-bold text-emerald-600 dark:text-emerald-400">{{ selectedLogTab }}</span>
        </div>
      </div>

      <button (click)="selectedLogTab = ''"
        class="text-gray-500 dark:text-slate-400 hover:text-gray-900 dark:hover:text-white hover:bg-rose-50 dark:hover:bg-rose-600/20 hover:text-rose-600 dark:hover:text-rose-500 rounded p-1.5 transition-all">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd" />
        </svg>
      </button>
    </div>

    <div
      class="flex-1 p-4 space-y-1 overflow-y-auto font-mono text-xs bg-gray-900 md:text-sm scrollbar-thin dark:bg-black/50 backdrop-blur">
      <div *ngIf="!projectLogs[selectedLogTab] || projectLogs[selectedLogTab].length === 0"
        class="italic text-gray-400 dark:text-slate-600">
        > Inicializando watcher de logs...
      </div>

      <div *ngFor="let log of projectLogs[selectedLogTab]"
        class="flex gap-2 px-1 leading-relaxed break-words rounded hover:bg-white/5 dark:hover:bg-white/5">
        <span class="text-gray-400 dark:text-slate-600 shrink-0 select-none w-[70px] text-right opacity-50">{{
          log.timestamp }}</span>
        <span [ngClass]="{
          'text-gray-200 dark:text-slate-300': log.type === 'info',
          'text-rose-500 dark:text-rose-400 font-bold': log.type === 'error',
          'text-cyan-500 dark:text-cyan-400 font-bold': log.type === 'system'
        }">
          <span class="text" [innerHTML]="log.text | ansiToHtml"></span>
        </span>
      </div>
    </div>
  </div>

</div>
